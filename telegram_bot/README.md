# Telegram-интеграция для аутентификации

Данный модуль обеспечивает интеграцию с Telegram для аутентификации пользователей в системе соревнований.

## Основной метод аутентификации

Основной метод аутентификации - использование **Telegram Login Widget** во фронтенде. Это самый удобный способ для пользователей, требующий всего один клик.

## Структура модуля

Модуль содержит:
1. **Telegram Bot** - бот для альтернативной аутентификации через бота (если виджет недоступен)
2. **API-сервер** - FastAPI сервер для верификации токенов от бота
3. **Утилиты** - функции для проверки данных Telegram

## Настройка

1. Создайте бота в Telegram с помощью [@BotFather](https://t.me/botfather)
2. Получите токен бота и сохраните его
3. Создайте файл `.env` на основе `env.example`:

```env
# Токен бота от BotFather
BOT_TOKEN=your_bot_token_here

# Настройки API
API_BASE_URL=http://localhost:8000/api/v1
API_BOT_KEY=shared_secret_key_with_backend

# URL фронтенда
FRONTEND_URL=http://localhost:5173

# Настройки сервера
WEBAPP_HOST=localhost
WEBAPP_PORT=3001
```

## Запуск

Для запуска и бота, и API-сервера используйте:

```bash
python -m telegram_bot.run
```

## Интеграция с фронтендом

Фронтенд использует два способа аутентификации:

1. **Telegram Login Widget** - основной способ (один клик)
2. **Аутентификация через бота** - запасной вариант

## Интеграция с бэкендом

Бэкенд обрабатывает данные от Telegram Login Widget и проверяет их подлинность:

1. В `auth.py` реализована проверка хеша данных от виджета
2. Реализовано создание/обновление пользователей на основе данных от Telegram
3. Для обратной совместимости сохранён эндпоинт для проверки токенов от бота

## Безопасность

- Все данные от Telegram Login Widget проверяются на подлинность через HMAC-SHA256
- Проверяется время аутентификации (auth_date), чтобы избежать атак повторного использования
- Все коммуникации между сервисами защищены API-ключами

## Схема аутентификации через виджет

1. Пользователь нажимает кнопку "Войти через Telegram"
2. Пользователь подтверждает передачу данных в Telegram
3. Telegram передает данные пользователя на сайт
4. Фронтенд отправляет данные на бэкенд
5. Бэкенд проверяет подлинность данных
6. Бэкенд создает/обновляет пользователя и выдает JWT-токен
7. Пользователь авторизован

## Дополнительно

Бот поддерживает команды:
- `/start` - Начать взаимодействие с ботом
- `/auth` - Получить код авторизации
- `/help` - Показать справку 